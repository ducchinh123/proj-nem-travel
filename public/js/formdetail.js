$(function(){$("#modal-fullframe").length>0&&$("#modal-fullframe").on("hide.bs.modal",function(e){$("body").css({overflow:"",height:"",position:""}),$("body").attr("topcurrent")&&($("html, body").animate({scrollTop:$("body").attr("topcurrent")},0),$("body").removeAttr("topcurrent"))}),$("#modal-fullsearch").on("hide.bs.modal",function(e){$("body").css({overflow:"",height:"",position:""}),$("body").attr("topcurrent")&&($("html, body").animate({scrollTop:$("body").attr("topcurrent")},0),$("body").removeAttr("topcurrent")),setTimeout(function(){$(".typeahead.tt-input").each(function(){$(this).val($("#searchTextFullFrame").val())})},500),document.activeElement.blur()}),$("#modal-fullsearch .input-icon-close").click(function(){$("#searchTextFullFrame").val(""),$("#searchTextFullFrame").focus()}),$(".search-fullframe").click(function(e){if(window.innerWidth<768){$("#modal-fullsearch").modal("show");var a=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",a+"px");var t=$(window).scrollTop();$("body").attr("topcurrent",t),$("body").css({overflow:"hidden",height:"100%",position:"fixed"}),$("html, body").animate({scrollTop:$("#modal-fullsearch").offset().top},200),$("#searchTextFullFrame").trigger("keypress"),setTimeout(function(){$("#searchTextFullFrame").val(""),$("#searchTextFullFrame").focus()},750)}})}),$(function(){var e,a,t=function(){return appAlias},s="",l=!0,d=!1,r=DepartDate,o=[],n=moment(r).format("YYYY-MM-DD");$(".get_date").val(n);var c=defaultAdult,h=0,u=0,p=0,m="",v=0,g=0,f=0,C="",b=!1,_=!1,k=!1,R=!1,A=[],y="",T=0,w=0,S=!1,x="hidden",D="",P=0,M="",Y="",B="",F=0,I=[],N=[],L=2,q=Handlebars.compile($("#handleBarsDepartureLocationItem").html(),{noEscape:!0}),E=0,O="",V=!1,H=!1;function G(e,a){if($(".ls-date").html(""),V)V=!1;else if(""!=e){var t=new Date(e),s=t.toLocaleString("default",{day:"2-digit"}),l=t.toLocaleString("default",{month:"2-digit"}),d=t.toLocaleString("default",{year:"numeric"});$(".ls-date").append('<li class="item box-white active" data-departdate="'+d+"-"+l+"-"+s+'">'+s+"/"+l+"</li>");var r=s+"-"+l+"-"+d,o=0,n=0,c="";a.forEach(e=>{var a=e.substring(0,2),t=e.substring(3,5),s=e.substring(6,10);r===e?(n=1,o>0&&($(".ls-date").prepend(c),n=3)):1===n&&n++,r!=e&&n>1&&n<=3&&($(".ls-date").append('<li class="item box-white" data-departdate="'+s+"-"+t+"-"+a+'">'+a+"/"+t+"</li>"),n++),o++,c='<li class="item box-white" data-departdate="'+s+"-"+t+"-"+a+'">'+a+"/"+t+"</li>"}),$(".ls-date .item").click(function(e){$(".ls-date .item").removeClass("active"),$(".panel-heading").removeClass("color-green"),$(".item-total-price").removeClass("hide-class"),$(".arrow-next").removeClass("hide-class"),$(this).addClass("active"),V=!0;var a=$(this).data("departdate");""===C?(C=a,ec(a)):C!=a&&(C=a,ec(a))})}}$(document).click(function(e){var a=$(".bg-shadow");a.hasClass("show")&&a.removeClass("show")}),$(".htdt-youtube.stopped").click(function(){var e=$(this).data("ytbid"),a=$(this).data("tourname");$(this).after('<article class="htdt-youtube playing"><h2>Video về <strong>'+a+'</h2><div class="htdt-embed"><iframe src="//www.youtube.com/embed/'+e+'?autoplay=1" frameborder="0" allowfullscreen></iframe></div></article>'),$(this).remove()}),$(window).load(function(){var d,r,_,k;s=$.trim($("#hdhdhdhhdhdhdhdhdhd").val()),$.ajax({type:"GET",url:t()+"Ajax/GetInfoUser",data:"okono="+s,async:!1,tryCount:0,retryLimit:1,success:function(e){E=e.UserLoginLevel,Q(s)},complete:function(){},error:function(e){}}),appAlias.length>1&&(doViewContentPixelNew(content_ids),doViewContentGtagPixelNew(gtagContent)),O=function e(a,t){var s=0;switch(a){case"OAppiOS":case"6":s=6;break;case"Email":case"7":s=7;break;case"OApp":case"8":s=8;break;case"OChat":case"9":s=9;break;case"AWeb":case"10":s=10;break;case"AMoWeb":case"11":s=11;break;case"AOAppiOS":case"16":s=16;break;case"AEmail":case"17":s=17;break;case"AOApp":case"18":s=18;break;case"AOChat":case"19":s=19;break;case"AOff":case"20":s=20;break;default:t&&(s=1)}return s}(location.search.split("utm-source=")[1]?location.search.split("utm-source=")[1].toString():"",isMobile),void 0===a&&(a=JSON.parse(sTourConfig.replace(/&quot;/g,'"'))),d=null!=retrievedObject?retrievedObject.DepartDate:n,r=c,_=h+u+p,k=m,$.ajax({type:"GET",url:t()+"Ajax/LoadFormPrice",data:"Tourid="+Tourid+"&AllotmentDate="+d+"&adult="+r+"&child="+_+"&childAges="+k,async:!1,tryCount:0,retryLimit:1,success:function(a){if("ER"!=a.Status){e=a,y=a.StrListDepartures;var d=a.TourRate.TotalRate;if(v=d,n=a.TourRate.AllotmentDate,$(".get_date").val(n),$(".number-adult").html(a.TourRate.Adults),ea(),c=a.TourRate.Adults,0==d)l=!0,ee();else{l=!1,$(".btn-right").removeClass("disable"),G(n,o=a.StrDepartures.split(",")),et("DateCheckinField"),$(".tourFormPrice").removeClass("hide-class"),$(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-1").removeClass("hidden"),$(".showMsgPrice span").removeClass("color-red"),$(".showMsgPrice span").removeClass("color-gray"),$(".showMsgPrice span").html("Li\xean hệ để x\xe1c nhận chỗ"),$(".showCancelPolicy").addClass("hide-class"),isCruise&&a.TourRate.Note&&($(".showCancelPolicy").html(a.TourRate.Note),$(".showCancelPolicy").removeClass("hide-class")),a.TourRate.AvaiableNo>0&&$(".showMsgPrice span").html("C\xf2n <b>"+a.TourRate.AvaiableNo+"</b> chỗ, li\xean hệ để x\xe1c nhận chỗ"),a.TourRate.RateAdultAvg>0&&adultSalePrice>a.TourRate.RateAdultAvg?(F=adultSalePrice/a.TourRate.RateAdultAvg,$(".priceDiv").addClass("v-margin-top-25"),$(".priceDiv .price-ota").removeClass("hidden"),$(".priceDiv .price-line").removeClass("hidden")):($(".priceDiv").removeClass("v-margin-top-25"),$(".priceDiv .price-ota").addClass("hidden"),$(".priceDiv .price-line").addClass("hidden")),g=d,ep(d),$(".priceDiv").removeClass("hide-class"),$(".check-Button").addClass("hide-class"),$(".check-ticket").removeClass("hide-class");var r=a.TourRate.RateAdultAvg/1e3;if(r>0&&($(".promotion-label span .price-hot").html(" | "+r.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+"k/kh\xe1ch"),$(".tourHeaderContainer .v-ribbon h1 .price-hot").html(" | "+r.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+"k/kh\xe1ch")),$(".RateAdultAvg").html(" x "+a.TourRate.RateAdultAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")),h>0?$(".RateChildInfantAvg").html(" x "+a.TourRate.RateChildInfantAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".RateChildInfantAvg").html(""),u>0?$(".RateChild1Avg").html(" x "+a.TourRate.RateChild1Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".RateChild1Avg").html(""),p>0?$(".RateChild2Avg").html(" x "+a.TourRate.RateChild2Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".RateChild2Avg").html(""),a.TourRate.RateSurchargeAdult>0?($(".RateSurchargeAdult").removeClass("hide-class"),$(".RateSurchargeAdult").html('<div class="col-xs-6 no-padding"><span class="text-left">'+a.TourRate.Note+'</span ></div><div class="col-xs-6 no-padding text-right"><span class="price-text">+ '+a.TourRate.RateSurchargeAdult.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND</span></div>")):($(".RateSurchargeAdult").addClass("hide-class"),$(".RateSurchargeAdult").html('<div class="col-xs-6 no-padding"><span class="text-left">&nbsp;</span ></div><div class="col-xs-6 no-padding text-right"><span class="price-text">&nbsp;</span></div>')),s.length>0&&a.TourRate.TotalCommission>0&&1==E&&($(".commistionRate").removeClass("hide-class"),$(".commistionRate").html('<div class="col-xs-6 no-padding"><span>Commision (A: '+a.TourRate.AvaiableNo+" - B: "+a.TourRate.BlockedNo+')</span></div><div class="col-xs-6 no-padding text-right"><span class="price-commisson">'+a.TourRate.TotalCommission.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND</span></div>"),$(".adviseButton").addClass("hidden")),isMobile||$(".wrapper-depart-date").find(".left").css("margin-bottom","0px"),$(".processing-Button").addClass("hide-class"),a.TourRate.Adults,a.TourRate.Childs,"IP"===a.TourRate.Status)l=!0,ee(),$(".showMsgAllotment").removeClass("hide-class"),$(".priceDiv").addClass("hide-class"),$(".book-Button").addClass("hide-class"),$(".advise-Button").addClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".specialrate-wrap-inner").addClass("hide-class"),$(".supplement").addClass("hide-class");else{if($(".showMsgAllotment").addClass("hide-class"),"AL"===e.TourRate.Status?$("#check-ticket-flight").is(":checked")?($(".book-Button").addClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").removeClass("hide-class"),$(".labelPrice").addClass("hidden")):($(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-2").removeClass("hidden"),$(".showMsgPrice span").addClass("color-red"),$(".showMsgPrice span").html("C\xf2n nhận <b>"+a.TourRate.AvaiableNo+"</b> chỗ"),$(".book-Button").removeClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".labelPrice").removeClass("hidden")):"SS"===e.TourRate.Status?($(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-3").removeClass("hidden"),$(".showMsgPrice span").addClass("color-gray"),$(".showMsgPrice span").html("Đ\xe3 hết chỗ! Vui l\xf2ng chọn ng\xe0y kh\xe1c"),$(".book-Button").addClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".advise-Button").removeClass("hide-class"),$(".request-disable-Button").removeClass("hide-class")):($(".book-Button").addClass("hide-class"),$(".request-Button").removeClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class")),null===a.TourRate.SpecialRate?$(".specialrate-wrap-inner").addClass("hide-class"):($(".specialrate-wrap-inner").removeClass("hide-class"),$("#SpecialTotalRate").val(a.TourRate.SpecialRate.TotalRate),$(".SpecialRateAdultAvg").html(" x "+a.TourRate.SpecialRate.RateAdultAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")),h>0?$(".SpecialRateChildInfantAvg").html(" x "+a.TourRate.SpecialRate.RateChildInfantAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".SpecialRateChildInfantAvg").html(""),u>0?$(".SpecialRateChild1Avg").html(" x "+a.TourRate.SpecialRate.RateChild1Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".SpecialRateChild1Avg").html(""),p>0?$(".SpecialRateChild2Avg").html(" x "+a.TourRate.SpecialRate.RateChild2Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".SpecialRateChild2Avg").html(""),$(".SpecialRateSurchargeAdult").addClass("hide-class"),a.TourRate.RateSurchargeAdult>0?$(".SpecialRateSurchargeAdult").html('<div class="col-xs-6 no-padding"><span class="text-left">'+a.TourRate.SpecialRate.Note+'</span ></div><div class="col-xs-6 no-padding text-right"><span class="price-text">+ '+a.TourRate.SpecialRate.RateSurchargeAdult.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND</span></div>"):$(".SpecialRateSurchargeAdult").html(""),en(a.TourRate.SpecialRate,!1)),$(".select-special-rate").removeAttr("checked"),a.SupplementRateDetails.length>0){f=a.SupplementRateDetails.length;for(var m,_,k,A,S=$("#handleListSupplementTours").html(),D=Handlebars.compile(S),M=[],Y=0;Y<a.SupplementRateDetails.length;Y++)a.SupplementRateDetails[Y].key=Y,a.SupplementRateDetails[Y].PriceFormat=a.SupplementRateDetails[Y].Price.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."),M.push(a.SupplementRateDetails[Y]);$(".wrap-supplement .ls-supplement").append(D(M))}eg(),Q(s),""!=y&&($("#tour-departure").removeClass("hidden"),$(".tour-departure").removeClass("hidden"),m=Tourid,_=y,k=c,A=JSON.stringify({Tourid:m,DepartureTime:_}),$.ajax({type:"POST",url:t()+"Ajax/loadCalendarDeparture",data:A,async:!0,beforeSend:function(){$(".loader").show()},success:function(a){var t=JSON.parse(a);if(t.length>0){var s,l,d,r=$("#handleListDepartureTours").html(),n=Handlebars.compile(r);N=[];for(var m=Math.max(...t.map(e=>parseFloat(e.PriceAdultAvg))),v=Math.min(...t.map(e=>parseFloat(e.PriceAdultAvg))),f=0;f<t.length;f++)if(0==f)var _=t[0].AllotmentDate;for(var f=0;f<t.length;f++)t[f].showOroff=x,t[f].PlusPoints="hidden",t[f].PriceAdult<=P?t[f].ShowInfoPoint="Book miễn ph\xed khi d\xf9ng điểm t\xedch lũy":t[f].ShowInfoPoint="Giảm "+P.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND khi d\xf9ng điểm t\xedch lũy",t[f].MemberPointPrice=(1e3*w).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."),t[f].PriceAdultAvg==v?t[f].redColor="green_color":t[f].PriceAdultAvg==m?t[f].redColor="red_color":t[f].redColor="",t[f].lsAllotmentDate=moment(t[f].AllotmentDate).format("YYYY-MM-DD"),t[f].strStartDate=moment(t[f].AllotmentDate).format("ddd, DD/MM/YYYY"),t[f].strEndDate=moment(t[f].AllotmentDate).add(iNightNo,"days").format("ddd, DD/MM/YYYY"),t[f].PriceAdult=t[f].PriceAdult.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."),t[f].PriceAdultAvgSort=t[f].PriceAdultAvg>=1e8?(t[f].PriceAdultAvg/1e6).toFixed(1).replace(".",",").replace(",0","")+"tr":t[f].PriceAdultAvg>=1e7?((t[f].PriceAdultAvg/1e6).toFixed(2).replace(".",",").replace(",00","")+"tr").indexOf(",")>0?((t[f].PriceAdultAvg/1e6).toFixed(2).replace(".",",").replace(",00","")+"tr").replace("0tr","tr"):(t[f].PriceAdultAvg/1e6).toFixed(2).replace(".",",").replace(",00","")+"tr":t[f].PriceAdultAvg>0?(t[f].PriceAdultAvg/1e3).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+"k":"",t[f].PriceAdultAvg=t[f].PriceAdultAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."),t[f].classAvailebleNo="","AL"===t[f].Status?(t[f].StrAvailableNo="C\xf2n "+t[f].AvaibleNo+" chỗ",t[f].classAvailebleNo="red-available"):"RQ"===t[f].Status?t[f].StrAvailableNo="Li\xean hệ":"SS"===t[f].Status&&(t[f].StrAvailableNo="Đ\xe3 hết chỗ"),t[f].key=f,t[f].flag_bg=f%2==0?"flag_bg":"",t[f].Adults=k,N.push(t[f]);$(".list-calendar-departure").append(n(N)),t.length<5&&$("#loadMore").addClass("hidden"),$(".calendar-departure .panel-default").slice(T,T+5).show(),$(".btn-heading").click(function(e){var a=$(this).parent().find(".AllotmentDate").val();V=!1,""===C?C=a:C!=a&&(C=a,$(".panel-heading").removeClass("color-green"),$(".item-total-price").removeClass("hide-class"),$(".arrow-next").removeClass("hide-class")),G(a,o),ec(a),$(this).toggleClass("color-green"),$(this).find(".item-total-price").toggleClass("hide-class"),$(this).find(".arrow-next").toggleClass("hide-class"),$(this).find("a").hasClass(":not(.collapsed)")&&$(".panel-heading").removeClass("color-green"),$(".desktop-booking-form").hasClass("hidden")?($("#mobile-booking-form").addClass("show"),$("html, body").animate({scrollTop:0},0)):(e.stopPropagation(),$(".bg-shadow").addClass("show"))}),eu(),et("DateCheckinField"),$(".plus-adult").click(function(){eo("adult","+",1,100)&&$(".number-adult").empty().append(c),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".minus-adult").click(function(){eo("adult","-",1,100)&&$(".number-adult").empty().append(c),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".plus-infant").click(function(e){eo("infant","+",1,100)&&$(".number-infant").empty().append(h),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".minus-infant").click(function(e){eo("infant","-",0,100)&&$(".number-infant").empty().append(h),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".plus-child").click(function(e){eo("child","+",1,100)&&$(".number-child").empty().append(u),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".minus-child").click(function(e){eo("child","-",0,100)&&$(".number-child").empty().append(u),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".plus-child2").click(function(e){eo("child2","+",1,100)&&$(".number-child2").empty().append(p),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),$(".minus-child2").click(function(e){eo("child2","-",0,100)&&$(".number-child2").empty().append(p),s&&clearTimeout(s),s=setTimeout(()=>{var e=$(".get_date").val();ec(e)},300)}),eh(),$("#check-ticket-flight").click(function(){$(this).is(":checked")?("Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").removeClass("hide-class"),$(".book-Button").addClass("hide-class")):"AL"===e.TourRate.Status?($(".book-Button").removeClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").addClass("hide-class")):($(".book-Button").addClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").removeClass("hide-class"))}),$("#loadMore").on("click",function(e){e.preventDefault(),$(".calendar-departure .panel-default:hidden").slice(T,T+5).slideDown(),$(".calendar-departure .panel-default:hidden").length-T==0&&$("#loadMore").addClass("hidden"),$("html,body").animate({},200)}),$(".btn-roll-mobile").click(function(){$("html, body").animate({scrollTop:$("#tour-departure").offset().top},1e3)}),$(".score-container__inner").click(function(){$("html, body").animate({scrollTop:$("#tour-review").offset().top},1e3)}),$(".requestPrice").click(function(){var e=$(".get_date").val();ec(e)}),$(".select-special-rate").click(function(){b=!!$(this).is(":checked"),ep(g)}),$("#DepartureText").html(moment(_).format("DD-MM-YYYY")),l=_,d=$("#DepartureField").daterangepicker({minDate:moment().add(1,"days").format("DD-MM-YYYY"),startDate:void 0!==l&&""!==l?moment(l):moment().add(1,"days"),showDropdowns:!0,singleDatePicker:!0,format:jsHelper.dateFormatter,buttonClasses:"btn btn-sm btn-flat",applyClass:"btn-success bg-blue",opens:"left",locale:{format:jsHelper.dateFormatter,cancelLabel:"Đ\xf3ng",applyLabel:"Chọn",daysOfWeek:"CN_T2_T3_T4_T5_T6_T7".split("_"),monthNames:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_")},isInvalidDate:function(e){return ed(e.format("DD-MM-YYYY"))}},function(e,a,t){}).on("show.daterangepicker",function(e,a){isMobile&&(0===$("#overlay").length&&$("body").append('<div id="overlay" style="display: block;"></div>'),$("#overlay").css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",zIndex:"98"}),$("#overlay").fadeIn(),$("body").css({overflow:"hidden"}),$(a.container).find(".opensleft").css("display","none"),$(a.container).find(".calendar-table").css("bottom","88px"),$(a.container).find(".calendar-table").addClass("slideIn"),ignorePopup=!0,$(".daterangepicker").css("top","unset"))}).on("showCalendar.daterangepicker",function(e,a){if(isMobile){var t=document.querySelector(".daterangepicker_custom_class2.show-calendar");t&&!t.querySelector(".calendar-header-mb")&&a.container.find(".calendar-table").prepend('<div class="calendar-header-mb"><div class="drag-handle"></div></div>'),R||(R=!0,es(t))}H?H=!1:ei(".daterangepicker.daterangepicker_custom_class2 .calendar.left.single table td.available")}).on("apply.daterangepicker",function(e,a){isMobile&&(a.container.find(".calendar-table").addClass("slideOut"),setTimeout(function(){a.container.find(".calendar-table").removeClass("slideIn")},20),setTimeout(function(){$("#overlay").css({display:"none"}),$("#overlay").fadeOut(),$(".daterangepicker.daterangepicker_custom_class2.show-calendar").hide(),$("#DepartureField").data("daterangepicker").hide()},400),setTimeout(function(){a.container.find(".calendar-table").removeClass("slideOut"),a.container.find(".calendar-header-mb").remove(),$("body").css({overflow:"",width:"",height:"",position:""})},600)),V=!1,$("#DepartureText").html(moment(a.startDate).format("DD-MM-YYYY")),$(".Getdeparture").val(moment(a.startDate).format("YYYY-MM-DD")),DepartDate=moment(a.startDate).format("YYYY-MM-DD");var t=moment(a.startDate).format("YYYY-MM-DD"),s=y.split(",");for(i=0;i<s.length;i++)if(t==s[i]){T=i;break}$(".calendar-departure .panel-default").css("display","none"),$(".calendar-departure .panel-default").slice(T,T+5).show(),$("#loadMore").removeClass("hidden"),$(".calendar-departure .panel-default:hidden").length-T==0&&$("#loadMore").addClass("hidden"),G(a.startDate,o),$(".get_date").val(moment(a.startDate).format("YYYY-MM-DD"));var l=$(".get_date").val();ec(l),H=!0}).data("daterangepicker"),$(".daterangepicker_custom_class2 .single .note-calenda").remove(),null!=d&&(d.container.addClass("daterangepicker_custom_class"),d.container.addClass("daterangepicker_custom_class2"),$(".daterangepicker_custom_class2 .single").append("<div class='note-calenda'><hr><span class='green_color'>* M\xe0u xanh l\xe1: ng\xe0y khởi h\xe0nh gi\xe1 tốt nhất</span><span class='red_color'>* M\xe0u đỏ: ng\xe0y khởi h\xe0nh gi\xe1 cao điểm</span><span>* Gi\xe1 hiển thị tr\xean 1 kh\xe1ch</span></div>")),$(".loader").hide()}},complete:function(){},error:function(){}}))}}}else l=!0,ee()},complete:function(){},error:function(e){}}),$.ajax({type:"GET",url:t()+"Ajax/GetAllBooking24H",data:"",async:!1,tryCount:0,retryLimit:1,success:function(e){if("ER"!=e.Status){var a=e.find(e=>e.Id==Tourid);void 0!==a&&a.TotalPax>0&&(""==promotionTitle?$(".countTourBooking24H").html("<span>Đang b\xe1n chạy</span>Đ\xe3 c\xf3 "+a.TotalPax+" kh\xe1ch đặt trong 24h qua"):$(".countTourBooking24H").html("Đ\xe3 c\xf3 "+a.TotalPax+" kh\xe1ch đặt trong 24h qua"),$(".countTourBooking24H").removeClass("hidden")),$(".tourBooking24H").each(function(){var a=e.find(e=>e.Id==$(this).data("id"));void 0!==a&&a.TotalPax>0&&($(this).html(a.TotalPax+" kh\xe1ch đặt trong 24h qua"),$(this).removeClass("hidden"))})}},complete:function(){},error:function(e){}}),$.ajax({type:"GET",url:t()+"Ajax/GetAllOrganizationReview",data:"",async:!1,tryCount:0,retryLimit:1,success:function(e){if("ER"!=e.Status){var a=e.find(e=>e.Id==OrganizationId);void 0!==a&&null!=a.Abbreviation&&""!=a.Abbreviation&&($(".tourHeaderTourOrganization .organization-abbreviation").html(a.Abbreviation),$(".tourHeaderTourOrganization .organization-star").html(a.AvgPoint.toFixed(1)),$(".tourHeaderTourOrganization .organization-number").html("("+a.NumOfReview+")"),$(".tourHeaderTourOrganization").removeClass("hidden"))}},complete:function(){},error:function(e){}}),function e(){jQuery.ajax({type:"GET",url:t()+"data/DepartureLocation.json",async:!0,success:function(e){I=e;var a="<div class='row'></div>";$.each(I,function(e,t){a=q(t),$("#departure-list").append(a)})},complete:function(){},error:function(){L>0&&(L--,e())}})}(),""==s&&$(".link-unit").addClass("hidden")}),$(window).resize(function(){ea()});let z=document.querySelectorAll(".panel-detail"),U=document.querySelectorAll("#my-navbar .navbar-nav li");function W(){if(document.body.scrollTop>250||document.documentElement.scrollTop>250?($(".wrap-navbar").addClass("fixed"),$(".bg-wrap-navbar").addClass("fixed")):($(".wrap-navbar").removeClass("fixed"),$(".bg-wrap-navbar").removeClass("fixed")),!isMobile){let e=$(".date-input-group").offset().top+$(".date-input-group").outerHeight()+8;$(".daterangepicker_custom_class1.show-calendar").css({position:"absolute",top:e+"px",display:"block"})}}function Q(e){$(".supplement").addClass("hide-class"),$(".link-unit").addClass("hidden"),$(".btn-request").html("Đặt Tour ngay"),$(".bookButton").html("Đặt Tour Ngay"),e.length>0||"true"==OpenBooking?e.length>0&&1==E&&($(".supplement").removeClass("hide-class"),$(".note-foragent").removeClass("hidden"),$(".link-unit").removeClass("hidden"),$(".adviseButton").addClass("hidden")):("Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").removeClass("hide-class"),$(".book-Button").addClass("hide-class"))}function X(){if($("#mobile-booking-form").removeClass("show"),!d&&!l&&s.length>0)return K(),!1;var a=document.getElementById("captchagg");$(".book-button").html("<h3><b>Gửi y\xeau cầu</b><br /><small>iVIVU sẽ li\xean hệ lại ngay sau \xedt ph\xfat</small></h3>"),a.disabled=!1,$("#getBundlePriceModal").modal("show"),1!=E&&""!=M?$("#customerName").val(M):$("#customerName").val(""),1!=E&&""!=B?$("#customerPhone").val(B):$("#customerPhone").val(""),1!=E&&""!=Y?$("#customerEmail").val(Y):$("#customerEmail").val(""),$("#notes").val(""),void 0===e&&(e=JSON.parse(sCurtentRate.replace(/&quot;/g,'"')));var r=new Date(n),o=adultSalePrice,c=1,h=0;l||(o=e.TourRate.TotalRate,r=new Date(e.TourRate.AllotmentDate),c=e.TourRate.Adults,h=e.TourRate.Childs),$(".modal-departure").html(moment(r).format("DD-MM-YYYY")),$(".modal-people").html(c+" người lớn "+h+" trẻ em");var u=r.setDate(r.getDate()+iNightNo),p=new Date(u);t().length>1&&(l||d?doRequestCheckoutPixelNew(o,content_ids,moment(r).format("YYYY-MM-DD"),moment(p).format("YYYY-MM-DD"),city,region,country,c,h):doInitiateCheckoutPixelNew(o,content_ids,moment(r).format("YYYY-MM-DD"),moment(p).format("YYYY-MM-DD"),city,region,country,c,h),gtagContent.coupon=gtagContent.items[0].coupon,doCheckoutGtagPixelNew(gtagContent))}function J(){var e=document.getElementById("captchagg"),a=$.trim($("#hdhdhdhhdhdhdhdhdhd").val()),s=0;if($(this).hasClass("bookTourBottom")){$("#customer_Name").parent().removeClass("has-error"),$("#customer_Phone").parent().removeClass("has-error");var r=/^[0-9]*$/,o="",n=$.trim($("#customer_Name").val()),c=$.trim($("#customer_Phone").val()),v=$.trim($("#customer_Email").val()),f=$.trim($("#notes_reqquest").val());isBlank(n)&&(o+="<li>Họ & T\xean</li>",Z("Họ & T\xean","customer_Name")),(isBlank(c)||null==c.match(r)||c.length<10||c.length>14)&&(o+="<li>Điện thoại</li>",Z("Vui l\xf2ng nhập số điện thoại!","customer_Phone")),s=1}else{$("#customerName").parent().removeClass("has-error"),$("#customerPhone").parent().removeClass("has-error"),$("#customerEmail").parent().removeClass("has-error");var r=/^[0-9]*$/,o="",n=$.trim($("#customerName").val()),c=$.trim($("#customerPhone").val()),v=$.trim($("#customerEmail").val()),f=$.trim($("#notes").val());isBlank(n)&&(o+="<li>Họ & T\xean</li>",Z("Họ & T\xean","customerName")),(isBlank(c)||null==c.match(r)||c.length<10||c.length>14)&&(o+="<li>Điện thoại</li>",Z("Vui l\xf2ng nhập số điện thoại!","customerPhone"))}if(isBlank(o)){(l||d)&&(s=1),e.disabled=!0,$(".book-button").html('<h3 style="margin:5px;"><b>Đang gửi y\xeau cầu</b></h3>');var C=$(".get_date").val(),_=$(".number-adult").html(),k=h+u+p,R=$("#DepartLocation").html(),A=topPlace,y=!1;$(this).parents().find("#check-ticket-flight").is(":checked")&&(y=!0);var T=ev(),w=$(".img-responsive").attr("src"),S=$(".timeName").data("timename"),x=$(".data-transport").data("transport"),M=JSON.stringify({Tourid:Tourid,date:C,adult:_,child:k,childAges:m,customerName:n,customerPhone:c,customerEmail:v,notes:f,nightNo:iNightNo,depart:R,destinations:A,IncludePrice:sIncludePrice,NoIncludePrice:sNoIncludePrice,CancelRules:sCancelRules,CancelRulesChange:sCancelRulesChange,flagCheck:b,numberSupplement:T,checkTicketFlight:y,okono:a,AvatarLink:w,TimeName:S,Transport:x,MemberId:D,UsePointPrice:P,AliasTour:content_ids,BookingType:bookingType,Source:O}),Y=parseInt(_)+parseInt(k),B={id:Tourid,date:C,adult:_,child:k,childAges:m,qty:Y,nightNo:iNightNo,totalRate:g,act:"book",customerName:n,customerPhone:c,customerEmail:v,notes:f};if(1==s){var F="GET",I=t()+"book",N=B;$(".btn-request").html("Đang gửi y\xeau cầu"),t().length>1&&doPaymentInfoGtagPixelNew(gtagContent,"Yeu Cau Tu Van")}else{var F="POST",I=t()+"Booking/getPrice",N=M;t().length>1&&doPaymentInfoGtagPixelNew(gtagContent,"Yeu Cau Dat Tour")}$.ajax({type:F,url:I,data:N,async:!0,success:function(e){if(1==s)swal({title:"Gửi y\xeau cầu th\xe0nh c\xf4ng",text:"IVIVU sẽ li\xean hệ lại qu\xfd kh\xe1ch trong thời gian sớm nhất. Xin cảm ơn.",timer:5e3,type:"success"}),$("#customer_Name").val(""),$("#customer_Phone").val(""),$("#customer_Email").val(""),$("#notes_reqquest").val(""),$(".btn-request").html("Đặt Tour ngay"),$("#getBundlePriceModal").modal("hide"),t().length>1&&(doRequestPixelNew(content_ids,e.StartDate,e.EndDate,city,region,country,e.AdultQuantity,e.ChildQuantity,e.TotalAmount),doPurchaseGtagPixelNew(gtagContent,e.RequestCode));else{var a=JSON.parse(e),l="M\xe3 đặt Tour của bạn l\xe0: <b style='color: #ffbd00'>"+a.Code+"</b><br>iVIVU sẽ li\xean hệ lại qu\xfd kh\xe1ch trong thời gian sớm nhất. Xin cảm ơn.";$("#getBundlePriceModal").modal("hide"),t().length>1&&(doPurchasePixelNew(content_ids,moment(a.StartDate).format("YYYY-MM-DD"),moment(a.EndDate).format("YYYY-MM-DD"),city,region,country,a.AdultNo,a.ChildNo,a.TotalPrices),doPurchaseGtagPixelNew(gtagContent,a.Code)),swal({title:"Gửi y\xeau cầu th\xe0nh c\xf4ng",text:l,html:!0,timer:5e3,type:"success"})}},complete:function(){},error:function(e){$("#getBundlePriceModal").modal("hide"),swal({title:"Gửi y\xeau cầu kh\xf4ng th\xe0nh c\xf4ng",text:"Việc Gửi y\xeau cầu của bạn kh\xf4ng th\xe0nh c\xf4ng. Vui l\xf2ng kiểm tra lại th\xf4ng tin!",timer:5e3,type:"error"}),$(".btn-request").html("Đặt Tour ngay")}})}else $("#warningContent").html("<ul>"+o+"</ul>")}function K(){var a=$(".get_date").val(),l=$(".number-adult").html(),d=h+u+p,r=$("#DepartLocation").html(),o=topPlace,n=new Date(e.TourRate.AllotmentDate),c=n.setDate(n.getDate()+iNightNo),v=new Date(c),g=!1;$(this).parents().find("#check-ticket-flight").is(":checked")&&(g=!0);var f=ev(),C=$(".JsonSurchargeFee").val(),_=$(".timeName").data("timename"),k=$(".data-transport").data("transport"),R=JSON.stringify({Tourid:Tourid,TourName:TourName,typeName:typeName,ImgLink:ImgLink,date:a,adult:l,child:d,childAges:m,nightNo:iNightNo,depart:r,destinations:o,IncludePrice:sIncludePrice,NoIncludePrice:sNoIncludePrice,CancelRules:sCancelRules,CancelRulesChange:sCancelRulesChange,flagCheck:b,isPickupQuest:isPickupQuest,isCruise:isCruise,numberSupplement:f,jsonSurchargeFee:C,okono:$("#hdhdhdhhdhdhdhdhdhd").val(),TimeName:_,Transport:k,AliasTour:content_ids,City:city,Region:region,Country:country,AppAlias:t(),MemberId:D,UsePointPrice:P,MemberFullName:M,MemberEmail:Y,MemberPhone:B,Inland:inland,BookingType:bookingType,Source:O,GtagContent:JSON.stringify(gtagContent)});$.ajax({url:t()+"Booking/CheckPrice",type:"POST",data:R,async:!0,crossDomain:!0,success:function(a){var l=a.Status;if("IP"===l)swal({title:"Hết chỗ",text:"Chỗ cuối c\xf9ng đ\xe3 được đặt vui l\xf2ng chọn ng\xe0y kh\xe1c",html:!0,timer:5e3,type:"error"}),$(".bookButton").button("reset");else if("RQ"===l&&s.length<0)$("#getBundlePriceModal").modal("show"),$(".bookButton").button("reset");else{t().length>1&&(doInitiateCheckoutPixelNew(e.TourRate.TotalRate,content_ids,moment(e.TourRate.AllotmentDate).format("YYYY-MM-DD"),moment(v).format("YYYY-MM-DD"),city,region,country,e.TourRate.Adults,e.TourRate.Childs),doCheckoutGtagPixelNew(gtagContent));var d=payURL+"thanh-toan-tour";$("#submitTourBookingContracting").attr("action",d).append("<input type='hidden' value='"+a.Data+"' name='transactionid' id='transactionid'/>").submit()}},complete:function(){},error:function(e){}})}function Z(e,a){if($("#"+a).length){var t=$("#"+a).attr("placeholder");$("#"+a).attr("placeholder",e),""!=a&&$("#"+a).css({border:"1px solid red"}),setTimeout(function(){""!=a&&($("#"+a).attr("placeholder",t),$("#"+a).css({border:""}))},3e3)}}function ee(){v=0,$(".get_date").val(n),$(".number-adult").html(1),G("",o),ea(),$(".box-white").addClass("lock"),$(".showMsgAllotment").addClass("hidden"),$(".RateSurchargeAdult").addClass("hidden"),$(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-0").removeClass("hidden"),$(".showMsgPrice span").removeClass("color-red"),$(".showMsgPrice span").removeClass("color-gray"),$(".showMsgPrice span").html("Chưa c\xf3 lịch khởi h\xe0nh"),$(".tourFormPrice").removeClass("hide-class"),$(".btn-right").addClass("disable"),$(".priceDiv").addClass("hidden"),$(".detail-departure").addClass("hidden")}function ea(){window.innerWidth<=768?($("#mobile-booking-form").removeClass("hidden"),$("#desktop-booking-form").addClass("hidden")):($("#desktop-booking-form").removeClass("hidden"),$("#mobile-booking-form").addClass("hidden"))}function et(e){$(".daterangepicker_custom_class2").removeClass("daterangepicker_custom_class1"),$(".daterangepicker.daterangepicker_custom_class1").removeClass("show-calendar"),$(".daterangepicker_custom_class1").remove();var a=$("."+e).daterangepicker({minDate:moment().add(1,"days").format("DD-MM-YYYY"),startDate:void 0!==n&&""!==n?moment(n):moment().add(1,"days"),showDropdowns:!0,singleDatePicker:!0,format:jsHelper.dateFormatter,buttonClasses:"btn btn-sm btn-flat",applyClass:"btn-success bg-blue",opens:"left",locale:{format:jsHelper.dateFormatter,cancelLabel:"Đ\xf3ng",applyLabel:"Chọn",daysOfWeek:"CN_T2_T3_T4_T5_T6_T7".split("_"),monthNames:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_")},isInvalidDate:function(e){return ed(e.format("DD-MM-YYYY"))}},function(e,a,t){}).on("show.daterangepicker",function(e,a){isMobile&&($(a.container).find(".opensright").css("display","none"),$(a.container).find(".calendar-table").css("bottom","88px"),$(a.container).find(".calendar-table").addClass("slideIn"),0===$("#overlay").length&&$("body").append('<div id="overlay" style="display: block;"></div>'),$("#overlay").css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",zIndex:"98"}),$("#overlay").fadeIn(),$("body").css({overflow:"hidden",height:"100%",width:"100%",position:"fixed"}),ignorePopup=!0,$(".daterangepicker").css("top","unset")),W()}).on("showCalendar.daterangepicker",function(e,a){if(isMobile){var t=document.querySelector(".daterangepicker_custom_class1.show-calendar");t&&!t.querySelector(".calendar-header-mb")&&$(".calendar-table").prepend('<div class="calendar-header-mb"><div class="drag-handle"></div></div>'),k||(k=!0,es(t))}H?H=!1:ei(".daterangepicker.daterangepicker_custom_class1 .calendar.left.single table td.available")}).on("hide.daterangepicker",function(e,a){$(".daterangepicker").removeClass("show-calendar")}).on("apply.daterangepicker",function(e,a){isMobile&&($(".calendar-table").addClass("slideOut"),setTimeout(function(){$(".calendar-table").removeClass("slideIn")},20),setTimeout(function(){$("#overlay").css({display:"none"}),$("#overlay").fadeOut(),$(".daterangepicker_custom_class1.show-calendar").hide(),$("#dates-date").data("daterangepicker").hide()},400),setTimeout(function(){$(".calendar-table").removeClass("slideOut"),$(".calendar-header-mb").remove(),$("body").css({overflow:"",width:"",height:"",position:""})},600)),V=!1,G(a.startDate,o),$(".get_date").val(moment(a.startDate).format("YYYY-MM-DD")),DepartDate=moment(a.startDate).format("YYYY-MM-DD");var t=$(".get_date").val();ec(t),H=!0}).data("daterangepicker");$(".daterangepicker_custom_class1 .single .note-calenda").remove(),null!=a&&($(".daterangepicker.dropdown-menu.single.opensleft").each(function(e){$(this).addClass("daterangepicker_custom_class"),$(this).addClass("daterangepicker_custom_class1"),$(".daterangepicker_custom_class2").removeClass("daterangepicker_custom_class1")}),$(".daterangepicker_custom_class1 .single").append("<div class='note-calenda'><hr><span class='green_color'>* M\xe0u xanh l\xe1: ng\xe0y khởi h\xe0nh gi\xe1 tốt nhất</span><span class='red_color'>* M\xe0u đỏ: ng\xe0y khởi h\xe0nh gi\xe1 cao điểm</span><span>* Gi\xe1 hiển thị tr\xean 1 kh\xe1ch</span></div>"))}function es(e){let a=0,t=!1,s=!1;null!=e&&(e.addEventListener("touchstart",function(t){a=t.touches[0].clientY;let l=t.target,d=e?.querySelector(".calendar-header-mb");s=!d||!!d.contains(l)}),e.addEventListener("touchmove",function(e){e.touches[0].clientY-a>10&&s&&(t=!0)},{passive:!1}),e.addEventListener("touchend",function(e){t&&(el(),t=!1)}))}function el(){$(".calendar-table").addClass("slideOut"),setTimeout(function(){$(".calendar-table").removeClass("slideIn")},20),setTimeout(function(){$("#overlay").css({display:"none"}),$("#overlay").fadeOut(),$(".daterangepicker_custom_class2").css("display","none"),$(".daterangepicker_custom_class1").css("display","none"),$(".daterangepicker.opensright").css("display","none"),$(".daterangepicker.openright").removeClass("show-calendar"),$(".daterangepicker.opensleft.daterangepicker_custom_class1").removeClass("show-calendar"),$(".daterangepicker.opensleft.daterangepicker_custom_class2").removeClass("show-calendar"),$(".daterangepicker.daterangepicker_custom_class1").removeClass("show-calendar")},400),setTimeout(function(){$(".calendar-table").css("bottom","0"),$(".calendar-table").removeClass("slideOut"),$("body").css({overflow:"",width:"",height:"",position:""})},600)}async function ei(e){await new Promise(e=>{setTimeout(()=>{e("ok")},0)}),$(".show-calendar").each(function(e,t){"block"==t.style.display&&(a=t)});var a,t=Number(a.getElementsByClassName("monthselect")[0].value)+1,s=t>1?(t-1).toString().padStart(2,"0"):"12",l=t.toString().padStart(2,"0"),d=t<12?(t+1).toString().padStart(2,"0"):"01",r=Number(a.getElementsByClassName("yearselect")[0].value),o=r.toString().padStart(4,"0"),n=!1;let c=-1;$(e).each(function(e){let a=$(this);var h=0,u=o+"-"+l+"-"+h.toString().padStart(2,"0");if(a.data("departdate"))u=a.data("departdate");else{u=o+"-"+l+"-"+(h=Number(a.context.innerHTML)).toString().padStart(2,"0");var p=Number(a.data("title").substring(1,2));h>21&&0==p?u=1==t?(r-1).toString().padStart(4,"0")+"-"+s+"-"+h.toString().padStart(2,"0"):o+"-"+s+"-"+h.toString().padStart(2,"0"):h<8&&p>=3&&(u=12==t?(r+1).toString().padStart(4,"0")+"-"+d+"-"+h.toString().padStart(2,"0"):o+"-"+d+"-"+h.toString().padStart(2,"0"))}n?c>=0&&c<N.length&&("SS"===N[c].Status?a.context.innerHTML="<span>"+N[c].PriceAdultAvgSort+"</span>"+h+"<em>&nbsp;</em>":(a.addClass(N[c].redColor),a.context.innerHTML="<span>"+N[c].PriceAdultAvgSort+"</span>"+h),a.context.dataset.departdate=N[c].lsAllotmentDate,c++):(c=N.findIndex(e=>e.lsAllotmentDate===u.toString()))>=0&&c<N.length&&("SS"===N[c].Status?a.context.innerHTML="<span>"+N[c].PriceAdultAvgSort+"</span>"+h+"<em>&nbsp;</em>":(a.addClass(N[c].redColor),a.context.innerHTML="<span>"+N[c].PriceAdultAvgSort+"</span>"+h),a.context.dataset.departdate=N[c].lsAllotmentDate,c++,n=!0)})}function ed(e){if(-1===$.inArray(e,o))return[!0]}function er(){$(".check-Button").hasClass("hide-class")&&($(".check-Button ").removeClass("hide-class"),$(".request-Button ").addClass("hide-class"),$(".book-Button").addClass("hide-class"),$(".check-ticket").addClass("hide-class"),$(".specialrate-wrap-inner").addClass("hide-class"),$(".priceDiv").addClass("hide-class"),$(".supplement").addClass("hide-class"),$(".RateAdultAvg").addClass("hide-class"),$(".SpecialRateAdultAvg").addClass("hide-class"),$(".RateChildAvg").addClass("hide-class"),$(".SpecialRateChildAvg").addClass("hide-class"),$(".RateSurchargeAdult").addClass("hide-class"),$(".SpecialRateSurchargeAdult").addClass("hide-class"),$(".commistionRate").addClass("hide-class"),$(".select-special-rate").removeAttr("checked"),$(".accumulation-point").addClass("hide-class"))}function eo(a,t,s,l){var d=!1;switch(a){case"adult":"-"===t?c>s&&(c--,d=!0):"+"===t&&e.TourRate.TotalRate<9631e6&&c<l&&(c++,d=!0);break;case"infant":"-"===t?h>s&&(h--,d=!0):"+"===t&&e.TourRate.TotalRate<9631e6&&h<l&&(h++,d=!0);break;case"child":"-"===t?u>s&&(u--,d=!0):"+"===t&&e.TourRate.TotalRate<9631e6&&u<l&&(u++,d=!0);break;case"child2":"-"===t?p>s&&(p--,d=!0):"+"===t&&e.TourRate.TotalRate<9631e6&&p<l&&(p++,d=!0)}return d}function en(e,a){var t=[];a?("null"!=e?$.each(JSON.parse(e.replace(/&quot;/g,'"')),function(e,a){t.push(a)}):$(".specialrate-wrap-inner").addClass("hide-class"),t.length>0&&($(".specialName").html(t[1]),$(".specialPrice").html(t[9].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND"),$(".SpecialTotalRate").val(t[9]))):null!=e&&($(".specialName").html(e.Name),$(".specialPrice").html(e.TotalRate.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND"),$(".SpecialTotalRate").val(e.TotalRate))}function ec(d){var r,o,c,C,_=$(".number-adult").html(),k=$(".number-infant").html(),R=$(".number-child").html(),A=$(".number-child2").html();$(".book-Button").addClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".request-disable-Button").addClass("hide-class"),isMobile||$(".wrapper-depart-date").find(".left").css("margin-bottom","10px"),$(".processing-Button").removeClass("hide-class"),$(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-3").removeClass("hidden"),$(".showMsgPrice span").addClass("color-gray"),$(".showMsgPrice span").html("Đang cập nhật số chỗ c\xf2n nhận");var y=0;if(m="",a.IsInfant&&k>0)for(var T=0;T<k;T++)0==y?(y=1,m+=""+(a.ChildAge1From-1)):m+=","+(a.ChildAge1From-1);if(a.IsChildAge1&&R>0)for(var T=0;T<R;T++)0==y?(y=1,m+=""+a.ChildAge1To):m+=","+a.ChildAge1To;if(a.IsChildAge2&&A>0)for(var T=0;T<A;T++)0==y?(y=1,m+=""+a.ChildAge2To):m+=","+a.ChildAge2To;r=d,o=_,c=h+u+p,C=m,$.ajax({type:"GET",url:t()+"Ajax/getPrice",data:"Tourid="+Tourid+"&AllotmentDate="+r+"&adult="+o+"&child="+c+"&listChildAges="+C,async:!0,success:function(a){if("ER"!==a.Status){e=a;var t=a.TourRate.TotalRate;if(v=t,g=t,n=a.TourRate.AllotmentDate,$(".get_date").val(n),0==t)l=!0,ee();else{l=!1,b=!1,ep(t),eg(),em(g),a.TourRate.RateAdultAvg>0&&adultSalePrice>a.TourRate.RateAdultAvg?(F=adultSalePrice/a.TourRate.RateAdultAvg,$(".priceDiv").addClass("v-margin-top-25"),$(".priceDiv .price-ota").removeClass("hidden"),$(".priceDiv .price-line").removeClass("hidden")):($(".priceDiv").removeClass("v-margin-top-25"),$(".priceDiv .price-ota").addClass("hidden"),$(".priceDiv .price-line").addClass("hidden")),$(".priceDiv").removeClass("hide-class"),$(".check-Button").addClass("hide-class"),$(".check-ticket").removeClass("hide-class"),$(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-1").removeClass("hidden"),$(".showMsgPrice span").removeClass("color-red"),$(".showMsgPrice span").removeClass("color-gray"),$(".showMsgPrice span").html("Li\xean hệ để x\xe1c nhận chỗ"),$(".showCancelPolicy").addClass("hide-class"),isCruise&&a.TourRate.Note&&($(".showCancelPolicy").html(a.TourRate.Note),$(".showCancelPolicy").removeClass("hide-class")),a.TourRate.AvaiableNo>0&&$(".showMsgPrice span").html("C\xf2n <b>"+a.TourRate.AvaiableNo+"</b> chỗ, li\xean hệ để x\xe1c nhận chỗ");var d=a.TourRate.RateAdultAvg/1e3;if(d>0&&($(".promotion-label span .price-hot").html(d.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+"k/kh\xe1ch"),$(".tourHeaderContainer .v-ribbon h1 .price-hot").html(d.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+"k/kh\xe1ch")),$(".RateAdultAvg").html(" x "+a.TourRate.RateAdultAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")),h>0?$(".RateChildInfantAvg").html(" x "+a.TourRate.RateChildInfantAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".RateChildInfantAvg").html(""),u>0?$(".RateChild1Avg").html(" x "+a.TourRate.RateChild1Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".RateChild1Avg").html(""),p>0?$(".RateChild2Avg").html(" x "+a.TourRate.RateChild2Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".RateChild2Avg").html(""),a.TourRate.RateSurchargeAdult>0?($(".RateSurchargeAdult").removeClass("hide-class"),$(".RateSurchargeAdult").html('<div class="col-xs-6 no-padding"><span class="text-left">'+a.TourRate.Note+'</span ></div><div class="col-xs-6 no-padding text-right"><span class="price-text">+ '+a.TourRate.RateSurchargeAdult.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND</span></div>")):($(".RateSurchargeAdult").addClass("hide-class"),$(".RateSurchargeAdult").html('<div class="col-xs-6 no-padding"><span class="text-lrft">&nbsp;</span ></div><div class="col-xs-6 no-padding text-right"><span class="price-text">&nbsp;</span></div>')),s.length>0&&a.TourRate.TotalCommission>0&&1==E&&($(".commistionRate").removeClass("hide-class"),$(".commistionRate").html('<div class="col-xs-6 no-padding"><span>Commision (A: '+a.TourRate.AvaiableNo+" - B: "+a.TourRate.BlockedNo+')</span></div><div class="col-xs-6 no-padding text-right"><span class="price-commisson">'+a.TourRate.TotalCommission.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND</span></div>"),$(".adviseButton").addClass("hidden")),isMobile||$(".wrapper-depart-date").find(".left").css("margin-bottom","0px"),$(".processing-Button").addClass("hide-class"),a.TourRate.Adults,a.TourRate.Childs,"IP"===e.TourRate.Status)l=!0,ee(),$(".showMsgAllotment").removeClass("hide-class"),$(".priceDiv").addClass("hide-class"),$(".book-Button").addClass("hide-class"),$(".advise-Button").addClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".specialrate-wrap-inner").addClass("hide-class"),$(".supplement").addClass("hide-class");else{$(".showMsgAllotment").addClass("hide-class"),"AL"===e.TourRate.Status?$("#check-ticket-flight").is(":checked")?($(".book-Button").addClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").removeClass("hide-class"),$(".labelPrice").addClass("hidden")):($(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-2").removeClass("hidden"),$(".showMsgPrice span").addClass("color-red"),$(".showMsgPrice span").html("C\xf2n nhận <b>"+a.TourRate.AvaiableNo+"</b> chỗ"),$(".book-Button").removeClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".labelPrice").removeClass("hidden")):"SS"===e.TourRate.Status?($(".showMsgPrice .ico-showPrice").addClass("hidden"),$(".showMsgPrice .ico-3").removeClass("hidden"),$(".showMsgPrice span").addClass("color-gray"),$(".showMsgPrice span").html("Đ\xe3 hết chỗ! Vui l\xf2ng chọn ng\xe0y kh\xe1c"),$(".book-Button").addClass("hide-class"),$(".request-Button").addClass("hide-class"),$(".advise-Button").removeClass("hide-class"),$(".request-disable-Button").removeClass("hide-class")):($(".book-Button").addClass("hide-class"),$(".request-Button").removeClass("hide-class"),"Free Sales"==typeName?$(".adviseButton").addClass("hidden"):$(".advise-Button").removeClass("hide-class")),null===e.TourRate.SpecialRate?$(".specialrate-wrap-inner").addClass("hide-class"):($(".specialrate-wrap-inner").removeClass("hide-class"),$(".SpecialTotalRate").val(e.TourRate.SpecialRate.TotalRate),$(".SpecialRateAdultAvg").html(" x "+a.TourRate.SpecialRate.RateAdultAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")),h>0?$(".SpecialRateChildInfantAvg").html(" x "+a.TourRate.RateChildInfantAvg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".SpecialRateChildInfantAvg").html(""),u>0?$(".SpecialRateChild1Avg").html(" x "+a.TourRate.RateChild1Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".SpecialRateChild1Avg").html(""),p>0?$(".SpecialRateChild2Avg").html(" x "+a.TourRate.RateChild2Avg.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")):$(".SpecialRateChild2Avg").html(""),$(".SpecialRateSurchargeAdult").addClass("hide-class"),a.TourRate.RateSurchargeAdult>0?$(".SpecialRateSurchargeAdult").html('<div class="col-xs-6 no-padding"><span class="text-left">'+a.TourRate.SpecialRate.Note+'</span ></div><div class="col-xs-6 no-padding text-right"><span class="price-text">+ '+a.TourRate.SpecialRate.RateSurchargeAdult.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND</span></div>"):$(".SpecialRateSurchargeAdult").html(""),en(a.TourRate.SpecialRate,!1)),$(".date-input-group").html("");var o=$("#handleBarsCalendar").html(),c=Handlebars.compile(o),m=[];if(m.dateCalendar=r,m.textCalendar=moment(r).format("DD-MM-YYYY"),m.push(m),$(".date-input-group").append(c(m)),n=r,et("DateCheckinField"),$(".wrap-supplement .ls-supplement").html(""),a.SupplementRateDetails.length>0){f=a.SupplementRateDetails.length;for(var C=$("#handleListSupplementTours").html(),_=Handlebars.compile(C),k=[],R=0;R<a.SupplementRateDetails.length;R++)a.SupplementRateDetails[R].key=R,a.SupplementRateDetails[R].PriceFormat=a.SupplementRateDetails[R].Price.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."),k.push(a.SupplementRateDetails[R]);$(".wrap-supplement .ls-supplement").append(_(k))}eh(),eu(),Q(s)}}}else l=!0,ee()},complete:function(){},error:function(){}})}function eh(){$(".plus-supplement").click(function(){var e=Number($(".supplement-"+$(this).data("id")).html())+1;e>100?e=100:($(".supplement-"+$(this).data("id")).html(e),em(g))}),$(".minus-supplement").click(function(){var e=$(".supplement-"+$(this).data("id")).html()-1;e<0?e=0:($(".supplement-"+$(this).data("id")).html(e),em(g))})}function eu(){$(".btn-general").click(function(){$(".panel-default a").addClass("collapsed"),$(".panel-default .panel-collapse").removeClass("in"),$(".panel-default .panel-heading").removeClass("color-green"),$(".item-total-price").removeClass("hide-class")})}function ep(e){var t=parseInt(e);if($(".totalPrice").html(t.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+' <span class="tourItemCurrency">VND</span>'),b){var s=$(".SpecialTotalRate").val();t=parseInt(s),$(".totalPrice").html(t.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+' <span class="tourItemCurrency">VND</span>'),$(".RateAdultAvg").addClass("hide-class"),$(".SpecialRateAdultAvg").removeClass("hide-class"),$(".RateChildAvg").addClass("hide-class"),$(".SpecialRateChildAvg").addClass("hide-class"),a.IsInfant&&h>0&&$(".group-infant .SpecialRateChildAvg").removeClass("hide-class"),a.IsChildAge1&&u>0&&$(".group-child .SpecialRateChildAvg").removeClass("hide-class"),a.IsChildAge2&&p>0&&$(".group-child2 .SpecialRateChildAvg").removeClass("hide-class"),$(".RateSurchargeAdult").addClass("hide-class"),$(".SpecialRateSurchargeAdult").removeClass("hide-class"),$(".select-special-rate").prop("checked",!0)}else $(".RateAdultAvg").removeClass("hide-class"),$(".SpecialRateAdultAvg").addClass("hide-class"),$(".RateChildAvg").addClass("hide-class"),a.IsInfant&&h>0&&$(".group-infant .RateChildAvg").removeClass("hide-class"),a.IsChildAge1&&u>0&&$(".group-child .RateChildAvg").removeClass("hide-class"),a.IsChildAge2&&p>0&&$(".group-child2 .RateChildAvg").removeClass("hide-class"),$(".SpecialRateChildAvg").addClass("hide-class"),$(".RateSurchargeAdult").removeClass("hide-class"),$(".SpecialRateSurchargeAdult").addClass("hide-class"),$(".select-special-rate").prop("checked",!1);em(t)}function em(e){var a=0,t=0,s=0,l=0,d="",r="";for(j=0,A=[];j<f;j++)(a=Number($(".supplement-"+j).html()))>0&&(t=Number($(".supplement-"+j).data("price")),s+=a*t,d=$(".supplement-"+j).data("supplement"),l=a*t,r+=" - "+d+" ("+a+" người): "+parseInt(l).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND",A.push({name:d,quantity:a,price:t}));var o=JSON.stringify(A);$(".note_supplement").val(r),$(".JsonSurchargeFee").val(o);var n=parseInt(e)+parseInt(s);if($(".select-special-rate").is(":checked")){var c=$(".SpecialTotalRate").val();n=parseInt(c)+parseInt(s)}$(".totalPrice").html(n.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+' <span class="tourItemCurrency">VND</span>');var h=0;F>1&&(h=F*n,$(".price-ota").removeClass("hide-class"),$(".price-line-detail").html(h.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" VND")),P>0?$(".member-point span").html("Bạn c\xf3 "+(P/1e3).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1.")+" điểm. T\xedch lũy th\xeam "+Math.floor(n/1e5)+" điểm iVIVU"):1==E&&$(".member-point span").html("T\xedch lũy th\xeam "+Math.floor(n/1e5)+" điểm iVIVU")}function ev(){for(var e=0,a="",t=0;t<f;t++)0==e?(e=1,a+=Number($(".supplement-"+t).html())):a+=","+Number($(".supplement-"+t).html());return a}function eg(){for(j=0;j<f;j++)$(".supplement-"+j).html(0);$(".note_supplement").val(""),$(".JsonSurchargeFee").val("[]")}window.onscroll=function(e){var a="";z.forEach(e=>{let t=e.offsetTop;t>200&&pageYOffset>=t+100&&(a=e.getAttribute("id"))});var t=0;U.forEach(e=>{if(e.classList.remove("active"),e.classList.contains(a)){e.classList.add("active");var s=t;switch(a){case"detail-overview":case"detail-schedule":$("#my-navbar .navbar-nav").scrollLeft(0);break;case"detail-departure":$("#my-navbar .navbar-nav").scrollLeft(110);break;case"detail-visainfo":$("#my-navbar .navbar-nav").scrollLeft(265);break;case"detail-tourguide":$("#my-navbar .navbar-nav").scrollLeft(400);break;case"detail-term-regulations":s>3?$("#my-navbar .navbar-nav").scrollLeft(490):$("#my-navbar .navbar-nav").scrollLeft(370);break;case"detail-review":s>4?$("#my-navbar .navbar-nav").scrollLeft(600):$("#my-navbar .navbar-nav").scrollLeft(460)}}t++}),isMobile,W()},$("#my-navbar li").click(function(){$("#my-navbar").addClass("fixed-m"),$(".btn-collapse").removeClass("show");var e=$(this).data("activecontent");$("html, body").animate({scrollTop:$("#"+e).offset().top-40},300)}),afterUserLogged(function(e){w=e.point,S=!0,w>0&&S&&(x=""),D=e.memberId,P=1e3*e.point,M=e.fullname,Y=e.email,B=e.phone}),$(".btn-AskForAdvice").click(J),$("#captchagg").click(J),$(".requestButton").click(function(){if(d=!1,$("#getBundlePriceModal .title").html("Y\xeau cầu đặt"),l)return!1;X()}),$(".adviseButton").click(function(){$("#getBundlePriceModal .title").html("Y\xeau cầu tư vấn"),d=!0,X()}),$(".btn-back-tour").click(function(){$("#mobile-booking-form").removeClass("show")}),$(".btn-bottom-request").click(function(){$("#mobile-booking-form").addClass("show"),$("html, body").animate({scrollTop:0},0)}),$(".fixed-footer-book-button").click(function(){$("html, body").animate({scrollTop:$(".mobile-booking-form").offset().top},300)}),$(".btn-collapse").click(function(e){$(".btn-collapse").toggleClass("show"),$("#my-navbar").toggleClass("fixed-m")}),$(".bookButton").click(K),$(window).on("scroll load resize",function(){}),$("#dates-date").daterangepicker({minDate:moment().add(1,"days"),startDate:void 0!=date&&""!=date?moment(date):moment().add(1,"days"),showDropdowns:!0,singleDatePicker:!0,format:jsHelper.dateFormatter,buttonClasses:"btn btn-sm btn-flat",applyClass:"btn-success bg-blue",opens:"right",locale:{format:jsHelper.dateFormatter,cancelLabel:"Đ\xf3ng",applyLabel:"Chọn",daysOfWeek:"CN_T2_T3_T4_T5_T6_T7".split("_"),monthNames:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_")}},function(e,a,t){}).on("show.daterangepicker",function(e,a){isMobile&&($(a.container).find(".calendar-table").addClass("slideIn"),$(a.container).find(".calendar-table.slideIn").click(function(){ignorePopup=!0}),0===$("#overlay").length&&$("body").append('<div id="overlay" style="display: block;"></div>'),$("#overlay").css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",zIndex:"98"}),$("#overlay").fadeIn(),$("body").css({overflow:"hidden",height:"100%",width:"100%",position:"fixed"}),ignorePopup=!0,$(".daterangepicker").css("top","unset"))}).on("showCalendar.daterangepicker",function(e,a){isMobile&&($(".calendar-table").prepend('<div class="calendar-header-mb"><div class="drag-handle"></div></div>'),_||(_=!0,es(document.querySelector(".daterangepicker.dropdown-menu.single.opensright"))))}).on("apply.daterangepicker",function(e,a){isMobile&&($(".calendar-table").addClass("slideOut"),setTimeout(function(){$(".calendar-table").removeClass("slideIn")},20),setTimeout(function(){$("#overlay").css({display:"none"}),$("#overlay").fadeOut(),$(".daterangepicker_custom_class1.show-calendar").hide(),$("#dates-date").data("daterangepicker").hide()},400),setTimeout(function(){$(".calendar-table").removeClass("slideOut"),$(".calendar-header-mb").remove(),$("body").css({overflow:"",width:"",height:"",position:""})},600)),$("#DateOfWeekCheckinStr").html(moment(a.startDate).format("dddd")),$("#DateCheckinStr").html(moment(a.startDate).format("DD-MM-YYYY")),DepartDate=moment(a.startDate).format("YYYY-MM-DD")}),$(document).on("click","#overlay",function(e){isMobile?ignorePopup?ignorePopup=!1:($(".departure-popover").hasClass("slideIn")&&closeDeparturePopover(),$(".calendar-table").hasClass("slideIn")&&el()):document.getElementById("departure").contains(e.target)||($(".departure-popover").data("display",!1),$(".departure-popover").css("display","none"))});var e$=function(e){var a=$(e).offset().top,t=$(e).find("li"),s=$.grep(t,function(e){return $(e).offset().top<=a+10}),l=$.grep(t,function(e){return $(e).offset().top>a+10}).length;if(l>0){s.sort(function(e,a){return $(a).offset().left-$(e).offset().left});var d=s[0];$(d).find(".overlay-text").removeClass("hover"),$($(d).find(".more-img")).html("Xem th\xeam "+l+" ảnh").show(),$(d).find(".desc-img").hide()}};$(".review-preload").each(function(){e$(this)}),$(".htdt-rev-showmore-btn").on("click",function(){ef($(this))});var ef=function(e){try{var a=$(e).parent(".htdt-rev-showmore"),s=a.data("total"),l=a.data("count");a.data("left");var d=""==a.data("load-count")||null==a.data("load-count")||void 0==a.data("load-count")?10:a.data("load-count"),r="TO"+Tourid;$.ajax({type:"GET",url:t()+"Ajax/TourReviewDetail",data:{hotelSlug:r,total:d,offset:l},dataType:"html",success:function(e){if(null!=e&&void 0!=e){if(""!=e.trim()){var t="",d=$.parseJSON(e);if(null!=d.reviews&&void 0!=d.reviews){$.each(d.reviews,function(e,a){t+='<div class="col-xs-12 customerReviewDetail ">',t+='<div class="horizontalLine"></div>',t+='<div class="col-xs-12 col-sm-3 col-md-3 col-lg-2">',t+='<div class="row">',t+='<div class="col-xs-12 vspacing3 customerReviewName">',t+='<span class="glyphicon glyphicon-user"></span>&nbsp;',t+="<span>"+a.CustomerName+"</span>",t+="</div>",t+="</div>",t+="</div>",t+='<div class="col-xs-12 col-sm-9 col-md-9 col-lg-10">',t+='<div class="row">',t+='<div class="col-xs-12 vspacing3">',null!=a.ReviewPoint&&void 0!=a.ReviewPoint&&""!=a.ReviewPoint&&(t+='<span class="scoreSpan">'+a.ReviewPoint+"</span>"),null!=a.ReviewMessage&&void 0!=a.ReviewMessage&&""!=a.ReviewMessage&&(t+='&nbsp;<span class="scoreStatus">'+a.ReviewMessage+"</span>"),""!=a.DateStayed&&null!=a.DateStayed&&void 0!=a.DateStayed&&(t+='<span class="scoreReviewDate">'+a.DateStayed+"</span>"),t+="</div>",t+='<div class="col-xs-12">',t+='<span class="customerReviewContent">'+a.BestFeature,t+="</span>",t+="</div>",a.Images.length>0&&(t+='<div class="col-xs-12 review-image-wrap review-preload">									<ul class="clearfix user-img-gallery" >'),$.each(a.Images,function(e,a){t+='<li>											<img src="'+a.ThumpUrl+'" origin-src="'+a.ImageUrl+'">												<div class="overlay-text hover">													<span class ="more-img"></span>													<span class="desc-img">'+(null!=a.Description?a.Description:"")+"</span >												</div>										  </li>"}),a.Images.length>0&&(t+="</ul></div>"),t+="</div>",t+="</div>",t+="</div>"}),$("div.customerReviewDetail").last().after(t),$(".review-preload").each(function(){e$(this)});var r=s-(l+d.loaded);a.data("left",r),a.data("count",l+d.loaded),$("span.htdt-rev-showmore-count").html(r),r<1&&a.hide()}else a.hide()}else a.hide()}},error:function(e){handleLogging("[Ajax] Hiển thị th\xeam Reviews","Stack: "+JSON.stringify(e)+", Param: "+JSON.stringify({hotelSlug:r,total:d,offset:l}))}})}catch(o){var n=JSON.stringify({HotelUrl:window.location.pathname,total:a.data("total"),count:a.data("count"),left:a.data("left"),loadCount:""==a.data("load-count")||null==a.data("load-count")||void 0==a.data("load-count")?10:a.data("load-count")});handleLogging("Hiển thị th\xeam Reviews","Stack: "+o.stack+", Param: "+n)}}}),function(e){e.fn.iVIVUslider=function(){var a,t,s=this.parent(".user-img-gallery").find("li"),l=s.length-1,d=e(window).width(),r=e(window).height(),o=[],n=[],c=[],h=0;s.each(function(){o[h]=e(this).find("img").attr("src"),n[h]=e(this).find("img").attr("origin-src"),c[h]=e(this).find(".overlay-text span.desc-img").text(),h++});var u='<div class="loadTempImages" style="visibility: hidden; position: absolute;">';for(h=0;h<n.length;h++)u+='<img src="'+n[h]+'">';function p(){t<l?t++:t=0,e(".ivivu-slider img").attr("src",n[t]),e(".ivivu-slider .view-description").text(c[t]),f(e(".ivivu-slider_indicators .horizal-thumbnail"),a.eq(t),300),a.eq(t).addClass("current").siblings().removeClass("current")}function m(){t>0?t--:t=l,e(".ivivu-slider img").attr("src",n[t]),e(".ivivu-slider .view-description").text(c[t]),f(e(".ivivu-slider_indicators .horizal-thumbnail"),a.eq(t),300),a.eq(t).addClass("current").siblings().removeClass("current")}function v(){e(".ivivu-slider-overlay,.ivivu-slider,.ivivu-slider_close,.ivivu-slider_indicators").fadeOut(),e(".ivivu-slider-overlay, .ivivu-slider, .ivivu-slider_close, .ivivu-slider_indicators, .loadTempImages").remove(),e("body").css({overflow:"auto"}),document.onkeydown=null}function g(e){(e=e||window.event).stopPropagation?e.stopPropagation():e.cancelBubble=!0}function f(e,a,t){var s,l=a.width()/2,d=a.position().left+l;return d=d+e.scrollLeft()-e.width()/2,e.animate({scrollLeft:d},void 0==t?1e3:t),this}u+="</div>",e("body").append(u+'<div class="ivivu-slider-overlay"></div><div class="ivivu-slider"><div class="ivivu-slider_in"><a class="ivivu-slider_close" href="javascript:;"></a><img src="" /><span class="view-description"></span><div class="next"></div><div class="prev"></div></div></div><div class="ivivu-slider_indicators"><div class="horizal-thumbnail"><div class="thumbnail-images"></div></div></div>'),this.click(function(l){var h,u,p,m,v;l.preventDefault(),t=s.index(this),e(".ivivu-slider img").attr("src",n[t]),e(".ivivu-slider .view-description").text(c[t]),h=e(".ivivu-slider"),e("body").css({overflow:"hidden"}),u=h.width(),p=(r-h.height())/2,r<=685&&(p=44),e(".ivivu-slider-overlay,.ivivu-slider_close,.ivivu-slider_indicators").fadeIn(),m="",v=0,s.each(function(){m+='<a href="javascript:;"><img src="'+o[v]+'" alt="'+c[v]+'"/></a>',v++}),e(".ivivu-slider_indicators .horizal-thumbnail .thumbnail-images").html(m).fadeIn(),(a=e(".ivivu-slider_indicators .horizal-thumbnail .thumbnail-images a")).eq(t).addClass("current").siblings().removeClass("current"),a.click(function(s){s.preventDefault(),e(this).addClass("current").siblings().removeClass("current"),f(e(".ivivu-slider_indicators .horizal-thumbnail"),e(this),300),t=a.index(this),function e(a){var t=a.width(),s=a.height();a.css({left:(d-t)/2,top:(r-s)/2})}(e(".ivivu-slider")),e(".ivivu-slider img").attr("src",n[t]),e(".ivivu-slider .view-description").text(c[t])}),h.css({left:(d-u)/2,top:p}).fadeIn()}),e(".ivivu-slider_close,.ivivu-slider-overlay,.ivivu-slider").click(function(e){e.preventDefault(),v()}),e(".ivivu-slider img, .ivivu-slider span").click(function(e){g(e)}),e(".next").click(function(e){e.preventDefault(),p(),g(e)}),e(".prev").click(function(e){e.preventDefault(),m(),g(e)}),document.onkeydown=function(e){27==(e=e||window.event).keyCode&&(e.preventDefault(),v()),39==e.keyCode&&(e.preventDefault(),p()),37==e.keyCode&&(e.preventDefault(),m())},history.pushState(null,null,location.href),window.onpopstate=function(){v()};var C=document.getElementsByClassName("ivivu-slider")[0];C.addEventListener("touchstart",function e(a){b=a.touches[0].clientX,_=a.touches[0].clientY},!1),C.addEventListener("touchmove",function e(a){if(null!==b&&null!==_){var t=a.touches[0].clientX,s=a.touches[0].clientY,l=b-t,d=_-s;Math.abs(l)>Math.abs(d)&&(l>0?p():m()),b=null,_=null,a.preventDefault()}},!1);var b=null,_=null},window.addEventListener("touchend",function(a){e("#overlay").css("display","none")})}(jQuery),$(".htdt-review").on("mousedown",".user-img-gallery li",function(){$(this).iVIVUslider()});